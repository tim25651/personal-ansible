#
# Install packages based on the monitor flag
# needs monitor_flag set
# needs headless_packages, headful_packages, held_packages
#
---
- name: Install headless packages
  become: yes
  apt:
    name: "{{ headless_packages }}"
    state: present

- name: Install headful packages
  become: yes
  apt:
    name: "{{ headful_packages }}"
    state: present
  when: monitor_flag

- name: Pin packages
  become: yes
  command: apt-mark hold "{{ held_packages | join(' ') }}"